(function(){"use strict";var e={1798:function(e,t,a){var i=a(5471),r=a(8505),s=a(1689),l=a(9456),n=a(5486),o=function(){var e=this,t=e._self._c;return t(r.A,[t(n.A,{staticClass:"pa-4"},[e.isStudentStorageFormVisible?t("createOrder",{attrs:{lead:e.leadData,universities:e.universities,"send-billing":e.sendBilling},on:{"update:sendBilling":function(t){e.sendBilling=t},"update:send-billing":function(t){e.sendBilling=t},submit:e.createOrderHandleSubmit}}):e._e(),e.isMBRFormVisible?t("createOrderMBO",{attrs:{lead:e.leadData,"send-billing":e.sendBilling},on:{"update:sendBilling":function(t){e.sendBilling=t},"update:send-billing":function(t){e.sendBilling=t},submit:e.createOrderHandleSubmit}}):e._e(),e.orderCreated?t(s.A,{staticClass:"pa-6 text-center",attrs:{elevation:"3"}},[t(l.A,{staticClass:"mb-3",attrs:{color:"success",size:"56"}},[e._v(" mdi-check-circle ")]),t("h3",{staticClass:"mb-2"},[e._v("Order Created!")]),t("p",{staticClass:"mb-6"},[e._v("Opening order...")])],1):e._e(),!e.leadLoaded||e.orderCreated||e.isSupportedLeadType?e._e():t(s.A,{staticClass:"pa-6 text-center",attrs:{elevation:"3"}},[t(l.A,{staticClass:"mb-3",attrs:{color:"warning",size:"48"}},[e._v(" mdi-alert-circle ")]),t("h3",[e._v("Unsupported Lead Type")]),t("p",[e._v(" Lead Type "),t("strong",[e._v(e._s(e.leadType))]),e._v(" is not supported. ")])],1)],1)],1)},d=[],c=(a(8111),a(1701),a(3110),a(8335),a(6521)),u=a(8834),m=a(1526),f=a(1770),_=a(8230),p=a(8412),b=a(5786),h=a(9940),v=function(){var e=this,t=e._self._c;return t(s.A,{staticClass:"pa-6 mx-auto",attrs:{elevation:"4","max-width":"1100"}},[t(u.ZR,[e._v(" Review and confirm Lead and Storage details before creating the Order ")]),t(f.A,{staticClass:"mb-6"}),t(_.A,{ref:"form",on:{submit:function(t){return t.preventDefault(),e.createOrderHandleSubmit.apply(null,arguments)}}},[t(p.A,{attrs:{dense:""}},[t(m.A,{attrs:{cols:"12"}},[t("div",{staticClass:"section-title"},[e._v("Lead Information")])]),t(m.A,{attrs:{cols:"12",md:"6"}},[t(h.A,{attrs:{label:"First Name",outlined:"",dense:""},model:{value:e.form.First_Name,callback:function(t){e.$set(e.form,"First_Name",t)},expression:"form.First_Name"}})],1),t(m.A,{attrs:{cols:"12",md:"6"}},[t(h.A,{attrs:{label:"Last Name",outlined:"",dense:""},model:{value:e.form.Last_Name,callback:function(t){e.$set(e.form,"Last_Name",t)},expression:"form.Last_Name"}})],1),t(m.A,{attrs:{cols:"12",md:"6"}},[t(h.A,{attrs:{label:"Phone",outlined:"",dense:""},model:{value:e.form.Phone,callback:function(t){e.$set(e.form,"Phone",t)},expression:"form.Phone"}})],1),t(m.A,{attrs:{cols:"12",md:"6"}},[t(h.A,{attrs:{label:"Email",outlined:"",dense:""},model:{value:e.form.Email,callback:function(t){e.$set(e.form,"Email",t)},expression:"form.Email"}})],1),t(m.A,{attrs:{cols:"12"}},[t(b.A,{attrs:{label:"University",items:e.universities,"item-text":"label","item-value":"value",outlined:"",dense:""},model:{value:e.form.Lead_University,callback:function(t){e.$set(e.form,"Lead_University",t)},expression:"form.Lead_University"}})],1),t(m.A,{attrs:{cols:"12"}},[t("div",{staticClass:"section-title mt-6"},[e._v("Move & Delivery")])]),t(m.A,{attrs:{cols:"12",md:"6"}},[t(h.A,{attrs:{type:"date",label:"Move Out Date",outlined:"",dense:""},model:{value:e.form.Move_Out_Date,callback:function(t){e.$set(e.form,"Move_Out_Date",t)},expression:"form.Move_Out_Date"}})],1),t(m.A,{attrs:{cols:"12",md:"6"}},[t(h.A,{attrs:{label:"Delivery Address",outlined:"",dense:""},model:{value:e.form.Delivery_Address,callback:function(t){e.$set(e.form,"Delivery_Address",t)},expression:"form.Delivery_Address"}})],1),t(m.A,{attrs:{cols:"12",md:"6"}},[t(h.A,{attrs:{label:"City",outlined:"",dense:""},model:{value:e.form.City,callback:function(t){e.$set(e.form,"City",t)},expression:"form.City"}})],1),t(m.A,{attrs:{cols:"12",md:"6"}},[t(h.A,{attrs:{label:"Zip Code",outlined:"",dense:""},model:{value:e.form.Zip_Code,callback:function(t){e.$set(e.form,"Zip_Code",t)},expression:"form.Zip_Code"}})],1),t(m.A,{attrs:{cols:"12"}},[t("div",{staticClass:"section-title mt-6"},[e._v("Storage Items")])]),t(m.A,{attrs:{cols:"12",md:"4"}},[t(h.A,{attrs:{type:"number",label:"Number of Bins",outlined:"",dense:""},model:{value:e.form.No_of_Bins,callback:function(t){e.$set(e.form,"No_of_Bins",e._n(t))},expression:"form.No_of_Bins"}})],1),t(m.A,{attrs:{cols:"12",md:"4"}},[t(h.A,{attrs:{type:"number",label:"Loose Items",outlined:"",dense:""},model:{value:e.form.No_of_Loose_Items,callback:function(t){e.$set(e.form,"No_of_Loose_Items",e._n(t))},expression:"form.No_of_Loose_Items"}})],1),t(m.A,{attrs:{cols:"12",md:"4"}},[t(h.A,{attrs:{label:"Total Items",value:e.totalItems,readonly:"",outlined:"",dense:""}})],1),t(m.A,{attrs:{cols:"12"}},[t("div",{staticClass:"section-title mt-6"},[e._v("Pricing")])]),t(m.A,{attrs:{cols:"12",md:"6"}},[t(b.A,{attrs:{label:"Pricing Type",items:["Manual","Auto"],outlined:"",dense:""},model:{value:e.pricingType,callback:function(t){e.pricingType=t},expression:"pricingType"}})],1),"Manual"===e.pricingType?t(m.A,{attrs:{cols:"12",md:"6"}},[t(h.A,{attrs:{type:"number",label:"Price per Item",outlined:"",dense:""},model:{value:e.pricePerItem,callback:function(t){e.pricePerItem=e._n(t)},expression:"pricePerItem"}})],1):e._e(),t(m.A,{attrs:{cols:"12",md:"6"}},[t(h.A,{attrs:{label:"Estimated Total Price",value:e.estimatedTotalPrice,readonly:"",outlined:"",dense:""}})],1),t(m.A,{attrs:{cols:"12"}},[t("div",{staticClass:"section-title mt-6"},[e._v("Billing")])]),t(m.A,{attrs:{cols:"12",md:"6"}},[t(b.A,{attrs:{label:"Send Billing *",items:["Yes","No","Select"],outlined:"",dense:"",required:"","persistent-hint":"",hint:"Required",rules:[e=>!!e||"Send Billing is required"]},model:{value:e.sendBillingLocal,callback:function(t){e.sendBillingLocal=t},expression:"sendBillingLocal"}})],1)],1),t(f.A,{staticClass:"my-6"}),t(c.A,{attrs:{color:"primary",block:"",large:"",type:"submit"}},[e._v(" Convert to Order ")])],1)],1)},g=[],A={name:"CreateOrder",props:{lead:{type:Object,required:!0},sendBilling:{type:String,default:"Select"},universities:{type:Array,default:()=>[]}},data(){return{form:{...this.lead,City:this.lead.City||"",Zip_Code:this.lead.Zip_Code||""},sendBillingLocal:this.sendBilling,pricingType:"Manual",pricePerItem:null,estimatedTotalPrice:0}},computed:{totalItems(){return Number(this.form.No_of_Bins||0)+Number(this.form.No_of_Loose_Items||0)}},watch:{sendBillingLocal(e){this.$emit("update:sendBilling",e)},totalItems:"calculatePricing",pricePerItem:"calculatePricing",pricingType:"calculatePricing"},methods:{calculatePricing(){if("Manual"===this.pricingType)this.estimatedTotalPrice=(this.pricePerItem||0)*this.totalItems;else{const e=this.pricingTable(this.totalItems);this.pricePerItem=e,this.estimatedTotalPrice=e*this.totalItems}},pricingTable(e){return e<=2?22.5:e<=5?20:e<=10?18:15},createOrderHandleSubmit(){this.$refs.form.validate()&&this.$emit("submit",{...this.form,Total_Item_Count:this.totalItems,Price_per_Item:this.pricePerItem||0,Estimated_Price:this.estimatedTotalPrice||0,Lead_Type:this.form.Lead_Type||"Student Storage"})}}},y=A,B=a(1656),C=(0,B.A)(y,v,g,!1,null,"b28a0516",null),O=C.exports,I=a(7155),x=function(){var e=this,t=e._self._c;return t(s.A,{staticClass:"pa-6 mx-auto",attrs:{elevation:"4","max-width":"1100"}},[t(u.ZR,[e._v(" Review and confirm Moving Box Rental details before creating the Order ")]),t(f.A,{staticClass:"mb-6"}),t(_.A,{ref:"form",on:{submit:function(t){return t.preventDefault(),e.handleSubmit.apply(null,arguments)}},model:{value:e.isValid,callback:function(t){e.isValid=t},expression:"isValid"}},[t(p.A,{attrs:{dense:""}},[t(m.A,{attrs:{cols:"12"}},[t("div",{staticClass:"section-title"},[e._v("Lead Information")])]),t(m.A,{attrs:{cols:"12",md:"6"}},[t(h.A,{attrs:{label:"First Name",outlined:"",dense:""},model:{value:e.form.First_Name,callback:function(t){e.$set(e.form,"First_Name",t)},expression:"form.First_Name"}})],1),t(m.A,{attrs:{cols:"12",md:"6"}},[t(h.A,{attrs:{label:"Last Name *",outlined:"",dense:"",rules:[e=>!!e||"Last name is required"],required:""},model:{value:e.form.Last_Name,callback:function(t){e.$set(e.form,"Last_Name",t)},expression:"form.Last_Name"}})],1),t(m.A,{attrs:{cols:"12",md:"6"}},[t(h.A,{attrs:{label:"Phone",outlined:"",dense:""},model:{value:e.form.Phone,callback:function(t){e.$set(e.form,"Phone",t)},expression:"form.Phone"}})],1),t(m.A,{attrs:{cols:"12",md:"6"}},[t(h.A,{attrs:{label:"Email",outlined:"",dense:""},model:{value:e.form.Email,callback:function(t){e.$set(e.form,"Email",t)},expression:"form.Email"}})],1),t(m.A,{attrs:{cols:"12"}},[t("div",{staticClass:"section-title mt-6"},[e._v("Rental Details")])]),t(m.A,{attrs:{cols:"12",md:"6"}},[t(h.A,{attrs:{type:"date",label:"Rental Start Date",outlined:"",dense:""},model:{value:e.form.Rental_Start_Date,callback:function(t){e.$set(e.form,"Rental_Start_Date",t)},expression:"form.Rental_Start_Date"}})],1),t(m.A,{attrs:{cols:"12",md:"6"}},[t(h.A,{attrs:{type:"date",label:"Rental End Date",outlined:"",dense:""},model:{value:e.form.Rental_End_Date,callback:function(t){e.$set(e.form,"Rental_End_Date",t)},expression:"form.Rental_End_Date"}})],1),t(m.A,{attrs:{cols:"12",md:"4"}},[t(h.A,{attrs:{type:"number",label:"Bedrooms Count",outlined:"",dense:"",min:"1"},model:{value:e.form.Bedrooms_Count,callback:function(t){e.$set(e.form,"Bedrooms_Count",e._n(t))},expression:"form.Bedrooms_Count"}})],1),t(m.A,{attrs:{cols:"12"}},[t("div",{staticClass:"section-title mt-6"},[e._v("Options")])]),t(m.A,{attrs:{cols:"12",md:"4"}},[t(I.A,{attrs:{label:"Free Rental"},model:{value:e.form.Free_Rental,callback:function(t){e.$set(e.form,"Free_Rental",t)},expression:"form.Free_Rental"}})],1),t(m.A,{attrs:{cols:"12",md:"4"}},[t(I.A,{attrs:{label:"Include Bubble Wrap (+$60)"},model:{value:e.form.Include_Bubble_Wrap,callback:function(t){e.$set(e.form,"Include_Bubble_Wrap",t)},expression:"form.Include_Bubble_Wrap"}})],1),t(m.A,{attrs:{cols:"12"}},[t("div",{staticClass:"section-title mt-6"},[e._v("Pricing")])]),t(m.A,{attrs:{cols:"12",md:"3"}},[t(h.A,{attrs:{label:"Total Boxes",value:e.totalBoxCount,outlined:"",dense:"",readonly:""}})],1),t(m.A,{attrs:{cols:"12",md:"3"}},[t(h.A,{attrs:{label:"Weeks",value:e.weeks,outlined:"",dense:"",readonly:""}})],1),t(m.A,{attrs:{cols:"12",md:"3"}},[t(h.A,{attrs:{label:"Box Tier",value:e.boxTier,outlined:"",dense:"",readonly:""}})],1),t(m.A,{attrs:{cols:"12",md:"3"}},[t(h.A,{attrs:{label:"Discount",value:e.discountLabel,outlined:"",dense:"",readonly:""}})],1),t(m.A,{attrs:{cols:"12",md:"6"}},[t(h.A,{attrs:{label:"Final Order Total",value:`$${e.orderTotal}`,outlined:"",dense:"",readonly:""}})],1),t(m.A,{attrs:{cols:"12"}},[t("div",{staticClass:"section-title mt-6"},[e._v("Billing")])]),t(m.A,{attrs:{cols:"12",md:"6"}},[t(b.A,{attrs:{label:"Send Billing *",items:["Yes","No","Select"],outlined:"",dense:"",rules:[e=>!!e||"Send Billing is required"],required:""},model:{value:e.sendBillingLocal,callback:function(t){e.sendBillingLocal=t},expression:"sendBillingLocal"}})],1)],1),t(f.A,{staticClass:"my-6"}),t(c.A,{attrs:{color:"primary",block:"",large:"",type:"submit"}},[e._v(" Convert to Order ")])],1)],1)},S=[],T={name:"CreateOrderMBO",props:{lead:{type:Object,required:!0},sendBilling:{type:String,default:"Select"}},data(){return{isValid:!1,sendBillingLocal:this.sendBilling,form:{...this.lead,Bedrooms_Count:this.lead.Bedrooms_Count||1,Free_Rental:Boolean(this.lead.Free_Rental),Include_Bubble_Wrap:Boolean(this.lead.Include_Bubble_Wrap)}}},computed:{totalBoxCount(){return 20*this.form.Bedrooms_Count},boxTier(){const e=this.totalBoxCount;return e<=20?1:e<=40?2:e<=60?3:e<=80?4:5},weeks(){if(!this.form.Rental_Start_Date||!this.form.Rental_End_Date)return 1;const e=new Date(this.form.Rental_Start_Date),t=new Date(this.form.Rental_End_Date),a=Math.ceil((t-e)/864e5);return Math.max(1,Math.ceil(a/7))},basePrice(){return{1:119,2:139,3:169,4:199,5:249}[this.boxTier]},additionalWeekRate(){return{1:50,2:65,3:80,4:95,5:110}[this.boxTier]},rentalCost(){return this.form.Free_Rental?0:this.basePrice+(this.weeks-1)*this.additionalWeekRate},discountMultiplier(){return this.weeks>=8?.8:this.weeks>=4?.9:1},discountLabel(){const e=Math.round(100*(1-this.discountMultiplier));return`${e}%`},orderTotal(){if(this.form.Free_Rental)return 0;const e=this.form.Include_Bubble_Wrap?60:0;return Math.round(this.rentalCost*this.discountMultiplier+e)}},watch:{sendBillingLocal(e){this.$emit("update:sendBilling",e)}},methods:{handleSubmit(){this.$refs.form.validate()&&this.$emit("submit",{First_Name:this.form.First_Name,Last_Name:this.form.Last_Name,Phone:this.form.Phone,Email:this.form.Email,Rental_Start_Date:this.form.Rental_Start_Date,Rental_End_Date:this.form.Rental_End_Date,Bedrooms_Count:this.form.Bedrooms_Count,Total_Box_Count:this.totalBoxCount,Free_Rental:this.form.Free_Rental,Include_Bubble_Wrap:this.form.Include_Bubble_Wrap,Box_Tier:this.boxTier,Weeks_Count:this.weeks,Base_Price:this.basePrice,Additional_Week_Rate:this.additionalWeekRate,Discount_Percentage:Math.round(100*(1-this.discountMultiplier)),Bubble_Wrap_Price:this.form.Include_Bubble_Wrap?60:0,Order_Total:this.orderTotal,Lead_Type:"Moving Box Rental"})}}},R=T,L=(0,B.A)(R,x,S,!1,null,"a87bd138",null),P=L.exports,N={name:"App",components:{createOrder:O,createOrderMBO:P},data(){return{leadId:null,leadData:null,leadLoaded:!1,leadType:null,universities:[],sendBilling:"Select",orderCreated:!1,createdOrderId:null,createdCustomerId:null}},computed:{isStudentStorageFormVisible(){return this.leadLoaded&&!this.orderCreated&&"Student Storage"===this.leadType},isMBRFormVisible(){return this.leadLoaded&&!this.orderCreated&&"Moving Box Rental"===this.leadType},isSupportedLeadType(){return["Student Storage","Moving Box Rental"].includes(this.leadType)}},mounted(){this.initializeZohoWidget()},methods:{initializeZohoWidget(){ZOHO.embeddedApp.on("PageLoad",this.handlePageLoad),ZOHO.embeddedApp.init()},async handlePageLoad(e){this.leadId=Array.isArray(e.EntityId)?e.EntityId[0]:e.EntityId;const t=await ZOHO.CRM.API.getRecord({Entity:"Leads",RecordID:this.leadId});this.leadData=t.data[0],this.leadType=this.leadData?.Lead_Type||null,this.leadLoaded=!0,await this.fetchUniversities()},async fetchUniversities(){const e=await ZOHO.CRM.API.getAllRecords({Entity:"Universities",page:1,per_page:200});this.universities=(e.data||[]).map(e=>({label:e.Name,value:e.id}))},async createOrderHandleSubmit(e){try{const t={leadId:this.leadId,leadType:this.leadType,send_billing:this.sendBilling,confirmedBy:this.leadData?.Owner?.id||null,confirmedAt:(new Date).toISOString(),orderDetails:e},a=await ZOHO.CRM.FUNCTIONS.execute("convertLeadtoCustomerOrder_Standalone",{arguments:JSON.stringify(t)}),i=JSON.parse(a.details.output);if("success"!==i.status)throw new Error(i.message);this.createdOrderId=i.orderId,this.createdCustomerId=i.customerId,this.orderCreated=!0,"Yes"===this.sendBilling&&("Student Storage"===this.leadType&&await this.createBillingSubscription(e),"Moving Box Rental"===this.leadType&&await this.createMBRBillingInvoice(e)),setTimeout(()=>{ZOHO.CRM.UI.Record.open({Entity:"Orders",RecordID:this.createdOrderId})},1e3)}catch(t){alert(t.message||"Order creation failed")}},async createBillingSubscription(e){const t={order:{id:this.createdOrderId,customer_id:this.createdCustomerId,Number_of_bins:e.No_of_Bins||0,Number_of_loose_items:e.No_of_Loose_Items||0}};await ZOHO.CRM.FUNCTIONS.execute("createZBillingSubscription",{arguments:JSON.stringify(t)})},async createMBRBillingInvoice(e){const t={orderId:this.createdOrderId,orderDetails:e};await ZOHO.CRM.FUNCTIONS.execute("createZBillingInvoice",{arguments:JSON.stringify(t)})}}},k=N,D=(0,B.A)(k,o,d,!1,null,null,null),M=D.exports,w=a(5453);i.Ay.use(w.A);var $=new w.A({});i.Ay.config.productionTip=!1,new i.Ay({vuetify:$,render:e=>e(M)}).$mount("#app")}},t={};function a(i){var r=t[i];if(void 0!==r)return r.exports;var s=t[i]={exports:{}};return e[i].call(s.exports,s,s.exports,a),s.exports}a.m=e,function(){var e=[];a.O=function(t,i,r,s){if(!i){var l=1/0;for(c=0;c<e.length;c++){i=e[c][0],r=e[c][1],s=e[c][2];for(var n=!0,o=0;o<i.length;o++)(!1&s||l>=s)&&Object.keys(a.O).every(function(e){return a.O[e](i[o])})?i.splice(o--,1):(n=!1,s<l&&(l=s));if(n){e.splice(c--,1);var d=r();void 0!==d&&(t=d)}}return t}s=s||0;for(var c=e.length;c>0&&e[c-1][2]>s;c--)e[c]=e[c-1];e[c]=[i,r,s]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var i in t)a.o(t,i)&&!a.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};a.O.j=function(t){return 0===e[t]};var t=function(t,i){var r,s,l=i[0],n=i[1],o=i[2],d=0;if(l.some(function(t){return 0!==e[t]})){for(r in n)a.o(n,r)&&(a.m[r]=n[r]);if(o)var c=o(a)}for(t&&t(i);d<l.length;d++)s=l[d],a.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return a.O(c)},i=self["webpackChunkzoho_app"]=self["webpackChunkzoho_app"]||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))}();var i=a.O(void 0,[504],function(){return a(1798)});i=a.O(i)})();
//# sourceMappingURL=app.4bec12d5.js.map